"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[373],{373:(e,a,t)=>{t.r(a),t.d(a,{default:()=>b});var l=t(2555),s=t(5043),r=t(9570),n=t(9059),o=t(570),i=t(28),c=t(3840),d=t(1200),m=t(6555),x=t(6089),g=t(2136),h=t(5683),p=t(579);const b=()=>{const{eventId:e}=(0,x._)(),{t:a}=(0,g.o)(),[b,u]=(0,s.useState)([]),[f,y]=(0,s.useState)(!1),[j,N]=(0,s.useState)(!1),[v,w]=(0,s.useState)(!1),[S,k]=(0,s.useState)(new Set),[C,A]=(0,s.useState)(()=>localStorage.getItem("email_bgFilename")||null),[T,B]=(0,s.useState)(()=>{try{const e=localStorage.getItem("email_config");return e?JSON.parse(e):{qrSize:1150,qrX:220,qrY:1110,fontSize:150,nameX:400,nameY:925,messageBefore:"",messageAfter:"",emailSubject:"",senderName:"",bodyTextColor:"#555555",footerTextColor:"#aaaaaa"}}catch(e){return{qrSize:1150,qrX:220,qrY:1110,fontSize:150,nameX:400,nameY:925,messageBefore:"",messageAfter:"",emailSubject:"",senderName:"",bodyTextColor:"#555555",footerTextColor:"#aaaaaa"}}});(0,s.useEffect)(()=>{const e=setTimeout(()=>{localStorage.setItem("email_config",JSON.stringify(T)),C&&localStorage.setItem("email_bgFilename",C)},500);return()=>clearTimeout(e)},[T,C]);const{modalContent:z,showModal:P,hideModal:E,showErrorModal:_,showConfirmModal:q}=(0,m.h)(),F=(0,s.useCallback)(async()=>{if(e){y(!0);try{const a=await(0,d.oP)(e);u(a),k(new Set)}catch(t){console.error("Failed to fetch tickets",t),_("".concat(a("errorCsvEmpty"),": ").concat(t.message))}finally{y(!1)}}},[e,_,a]);(0,s.useEffect)(()=>{e?F():u([])},[e,F]);const I=(0,s.useMemo)(()=>[...b].sort((e,a)=>{const t=e=>"error"===e.emailStatus?0:e.emailStatus&&"sent"===e.emailStatus?2:1;return t(e)-t(a)}),[b]),M=e=>{const{name:a,value:t}=e.target;B(e=>(0,l.A)((0,l.A)({},e),{},{[a]:["messageBefore","messageAfter","emailSubject","senderName","bodyTextColor","footerTextColor"].includes(a)?t:parseInt(t)||0}))},X=e=>{if(!e)return"";return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>").replace(/\[color[:=]([^\]]+)\](.*?)\[\/color\]/gi,'<span style="color: $1">$2</span>').replace(/\[b\](.*?)\[\/b\]/gi,"<strong>$1</strong>")};return e?(0,p.jsxs)(o.A,{children:[(0,p.jsxs)("div",{className:"flex-1 flex flex-col h-full relative overflow-hidden",children:[(0,p.jsx)("div",{className:"fixed inset-0 pointer-events-none ambient-glow -z-10"}),(0,p.jsxs)("div",{className:"p-4 pt-16 md:p-8 flex flex-col h-full max-w-7xl mx-auto w-full",children:[(0,p.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-end mb-8 pb-4 border-b border-white/10 gap-4 shrink-0",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("h1",{className:"text-3xl font-bold text-white rainbow-text tracking-tight",children:a("emailTitle")}),(0,p.jsxs)("p",{className:"text-gray-400 mt-1 flex items-center gap-2",children:[a("emailManageCommunications"),(0,p.jsx)("span",{className:"glass-panel px-2 py-0.5 rounded text-purple-300 font-mono text-sm",children:e})]})]}),(0,p.jsxs)("div",{className:"flex gap-3 flex-wrap",children:[(0,p.jsx)(c.A,{variant:"glass",onClick:()=>{const e=b.filter(e=>"sent"!==e.emailStatus).map(e=>e.id);e.length>0?k(new Set(e)):alert("All tickets have been sent!")},className:"px-4 py-3 text-sm",children:"Select Unsent"}),(0,p.jsx)(c.A,{variant:"glass",onClick:()=>w(!v),className:"px-6 py-3",icon:"\u2699\ufe0f",children:a("btnSettings")}),(0,p.jsx)(c.A,{variant:"primary",onClick:async()=>{const t=S.size>0?b.filter(e=>S.has(e.id)):b;if(0===t.length)return _("No tickets available to send.");q(a("modalSendBatchTitle"),a("modalSendBatchBody",t.length),async()=>{E(),N(!0);try{const a=await(0,d.IL)(e,C,T,T.messageBefore,T.messageAfter,T.emailSubject,T.senderName,S.size>0?Array.from(S):null);let t="Batch Complete!\nSuccess: ".concat(a.result.success,"\nFailed: ").concat(a.result.failed);a.result.errors&&a.result.errors.length>0&&(t+="\n\nErrors:\n".concat(a.result.errors.join("\n"))),alert(t),F()}catch(t){_("".concat(a("importFailed"),": ").concat(t.message))}finally{N(!1)}})},disabled:j||f,loading:j,loadingText:"Sending...",className:"px-6 py-3",icon:"\ud83d\ude80",children:S.size>0?"Send to ".concat(S.size):a("btnBatch")})]})]}),(0,p.jsx)(r.N,{children:v&&(0,p.jsx)(n.P.div,{initial:{height:0,opacity:0,marginBottom:0},animate:{height:"auto",opacity:1,marginBottom:32,transition:{ease:h.Ux.gentle,duration:.4}},exit:{height:0,opacity:0,marginBottom:0,transition:{ease:h.Ux.gentle,duration:.3}},className:"overflow-hidden relative z-50 shrink-0",children:(0,p.jsxs)("div",{className:"glass-panel p-6 rounded-3xl border border-white/10 bg-white/5 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:[(0,p.jsxs)("div",{className:"col-span-1 md:col-span-2 xl:col-span-1",children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("labelBg")}),(0,p.jsx)("input",{type:"file",onChange:async e=>{const l=e.target.files[0];if(l)try{const e=await Promise.resolve().then(t.bind(t,1200)).then(e=>e.uploadBackground(l));A(e.filename||e)}catch(s){_("".concat(a("errorUploadFailed"),": ").concat(s.message))}},className:"block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100"}),C&&(0,p.jsxs)("p",{className:"text-xs text-green-400 mt-1 truncate",children:["Active: ",C]})]}),(0,p.jsxs)("div",{className:"col-span-1 md:col-span-1 xl:col-span-2",children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("labelSubject")}),(0,p.jsx)("input",{type:"text",name:"emailSubject",value:T.emailSubject,onChange:M,placeholder:a("emailSubjectPlaceholder"),className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none text-sm"})]}),(0,p.jsxs)("div",{className:"col-span-1 md:col-span-1 xl:col-span-1",children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("labelSender")}),(0,p.jsx)("input",{type:"text",name:"senderName",value:T.senderName,onChange:M,placeholder:a("emailSenderPlaceholder"),className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none text-sm"})]}),(0,p.jsxs)("div",{className:"col-span-1 md:col-span-2 xl:col-span-2",children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("labelPreamble")}),(0,p.jsx)("textarea",{name:"messageBefore",value:T.messageBefore,onChange:M,placeholder:a("emailPreamblePlaceholder"),className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none h-24 text-sm resize-none"})]}),(0,p.jsxs)("div",{className:"col-span-1 md:col-span-2 xl:col-span-2",children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("labelFinePrint")}),(0,p.jsx)("textarea",{name:"messageAfter",value:T.messageAfter,onChange:M,placeholder:a("emailFinePrintPlaceholder"),className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none h-24 text-sm resize-none"})]}),(0,p.jsxs)("div",{className:"col-span-1 md:col-span-2 xl:col-span-2 grid grid-cols-2 gap-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:"Body Color"}),(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("input",{type:"color",name:"bodyTextColor",value:T.bodyTextColor||"#555555",onChange:M,className:"w-10 h-10 rounded border border-gray-700 bg-transparent cursor-pointer"}),(0,p.jsx)("input",{type:"text",name:"bodyTextColor",value:T.bodyTextColor||"#555555",onChange:M,className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none text-sm"})]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:"Footer Color"}),(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("input",{type:"color",name:"footerTextColor",value:T.footerTextColor||"#aaaaaa",onChange:M,className:"w-10 h-10 rounded border border-gray-700 bg-transparent cursor-pointer"}),(0,p.jsx)("input",{type:"text",name:"footerTextColor",value:T.footerTextColor||"#aaaaaa",onChange:M,className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none text-sm"})]})]})]}),(0,p.jsx)("div",{className:"col-span-1 md:col-span-2 xl:col-span-2 grid grid-cols-3 gap-4",children:["qrSize","qrX","qrY","fontSize","nameX","nameY"].map(e=>(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:e}),(0,p.jsx)("input",{type:"number",name:e,value:T[e],onChange:M,className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none"})]},e))})]})})}),(0,p.jsx)("div",{className:"glass-panel rounded-3xl overflow-hidden border border-white/5 flex-1 flex flex-col min-h-0",children:(0,p.jsxs)("div",{className:"overflow-y-auto overflow-x-auto custom-scrollbar flex-1",children:[(0,p.jsxs)("table",{className:"w-full text-left border-collapse relative",children:[(0,p.jsx)("thead",{className:"bg-gray-950/95 backdrop-blur text-gray-400 text-xs uppercase tracking-wider sticky top-0 z-10 shadow-sm",children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{className:"p-4 w-10",children:(0,p.jsx)("input",{type:"checkbox",checked:b.length>0&&S.size===b.length,onChange:()=>{S.size===b.length?k(new Set):k(new Set(b.map(e=>e.id)))},className:"rounded border-gray-600 bg-transparent focus:ring-indigo-500"})}),(0,p.jsx)("th",{className:"p-4",children:a("colAttendee")}),(0,p.jsx)("th",{className:"p-4",children:a("colEmail")}),(0,p.jsx)("th",{className:"p-4",children:a("colStatus")}),(0,p.jsx)("th",{className:"p-4 text-right",children:a("colActions")})]})}),(0,p.jsx)(n.P.tbody,{variants:h.tl,initial:"hidden",animate:"visible",className:"divide-y divide-white/5",children:I.map(l=>(0,p.jsxs)(n.P.tr,{variants:h.tE,layout:!0,className:"hover:bg-white/5 transition-colors ".concat(S.has(l.id)?"bg-indigo-500/10":""),onClick:()=>(e=>{const a=new Set(S);a.has(e)?a.delete(e):a.add(e),k(a)})(l.id),children:[(0,p.jsx)("td",{className:"p-4",children:(0,p.jsx)("input",{type:"checkbox",checked:S.has(l.id),onChange:()=>{},className:"rounded border-gray-600 bg-transparent focus:ring-indigo-500 pointer-events-none"})}),(0,p.jsx)("td",{className:"p-4 font-medium selectable",children:l.attendeeName}),(0,p.jsx)("td",{className:"p-4 text-gray-400 selectable",children:l.attendeeEmail}),(0,p.jsxs)("td",{className:"p-4",children:[(0,p.jsx)("span",{className:"px-2 py-1 rounded text-xs font-bold ".concat("checked-in"===l.status?"bg-green-500/20 text-green-400":"bg-blue-500/20 text-blue-400"),children:l.status}),"sent"===l.emailStatus&&(0,p.jsx)("span",{className:"ml-2 text-xs",children:"\u2705 Sent"})]}),(0,p.jsxs)("td",{className:"p-4 text-right space-x-2 flex justify-end",onClick:e=>e.stopPropagation(),children:[(0,p.jsx)(c.A,{variant:"secondary",onClick:()=>(async l=>{y(!0);try{const s=await Promise.resolve().then(t.bind(t,1200)).then(a=>a.getEmailPreview(e,l.id,C,T)),r=T.messageBefore||a("emailDefaultMsgBefore",e),n=T.messageAfter||a("emailDefaultMsgAfter"),o=(0,p.jsx)("div",{className:"p-0 bg-gray-50 text-gray-800 rounded-xl max-w-2xl mx-auto border shadow-lg max-h-[80vh] overflow-y-auto",children:(0,p.jsxs)("div",{className:"bg-white p-8 text-center",children:[(0,p.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900",children:"Ticket Preview"}),(0,p.jsx)("p",{className:"text-gray-600 mb-6",dangerouslySetInnerHTML:{__html:X(r)}}),(0,p.jsx)("div",{className:"mb-6",children:(0,p.jsx)("img",{src:s,alt:"Ticket Preview for ".concat(l.attendeeName),loading:"lazy",className:"w-full h-auto rounded shadow-lg border"})}),(0,p.jsx)("p",{className:"text-gray-600 mb-6",dangerouslySetInnerHTML:{__html:X(n)}}),(0,p.jsxs)("p",{className:"text-xs text-gray-400 mt-8 pt-4 border-t",children:["Ticket ID: ",l.id]})]})});P({type:"custom",title:a("btnSimulate"),body:o,contentComponent:()=>o})}catch(s){_("Preview failed: ".concat(s.message))}finally{y(!1)}})(l),className:"w-auto py-1.5 px-3 text-xs bg-gray-800 border-white/10",children:a("btnSimulate")}),(0,p.jsx)(c.A,{variant:"secondary",onClick:()=>(async t=>{if(!t.attendeeEmail)return _("This ticket has no email address.");N(!0);try{await(0,d.z9)(e,t.id,C,T,T.messageBefore,T.messageAfter,T.emailSubject,T.senderName),alert(a("emailSent",t.attendeeEmail))}catch(l){_("".concat(a("importFailed"),": ").concat(l.message))}finally{N(!1)}})(l),disabled:j,loading:j,className:"w-auto py-1.5 px-3 text-xs bg-indigo-600/20 text-indigo-300 border-indigo-500/30 hover:bg-indigo-600/40",children:a("btnHarass")})]})]},l.id))})]}),0===b.length&&!f&&(0,p.jsx)("div",{className:"p-12 text-center text-gray-500",children:a("emptyEmail")})]})})]})]}),(0,p.jsx)(i.A,{isOpen:!!z,onClose:E,content:z||{}})]}):(0,p.jsxs)(o.A,{children:[(0,p.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-500 h-full",children:a("errorNoEventSelected")}),(0,p.jsx)(i.A,{isOpen:!!z,onClose:E,content:z||{}})]})}}}]);
//# sourceMappingURL=373.7ab21e82.chunk.js.map