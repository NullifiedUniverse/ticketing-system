{"version":3,"file":"static/js/373.863dfb4c.chunk.js","mappings":"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","sources":["components/EmailDashboard.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport Layout from './Layout';\nimport Modal from './Modal';\nimport SmartButton from './SmartButton';\nimport { getTickets, sendTicketEmail, sendBatchEmails } from '../services/api';\nimport { useModal } from '../hooks/useModal';\nimport { useEvent } from '../context/EventContext';\nimport { useLanguage } from '../context/LanguageContext';\nimport { buttonClick, containerStagger, fadeInUp, EASING } from '../utils/animations';\n\nconst EmailDashboard = () => {\n    const { eventId } = useEvent();\n    const { t } = useLanguage();\n    const [tickets, setTickets] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const [sending, setSending] = useState(false);\n    const [showSettings, setShowSettings] = useState(false);\n    const [selectedTicketIds, setSelectedTicketIds] = useState(new Set());\n    \n    const [bgFilename, setBgFilename] = useState(null);\n    const [config, setConfig] = useState({\n        qrSize: 1150, qrX: 220, qrY: 1110,\n        fontSize: 150, nameX: 400, nameY: 925,\n        messageBefore: '',\n        messageAfter: '',\n        emailSubject: '',\n        senderName: ''\n    });\n\n    const { modalContent, showModal, hideModal, showErrorModal, showConfirmModal } = useModal();\n\n    const fetchTickets = useCallback(async () => {\n        if (!eventId) return;\n        setLoading(true);\n        try {\n            const data = await getTickets(eventId);\n            setTickets(data);\n            setSelectedTicketIds(new Set()); // Reset selection on refresh\n        } catch (err) {\n            console.error(\"Failed to fetch tickets\", err);\n            showErrorModal(`${t('errorCsvEmpty')}: ${err.message}`);\n        } finally {\n            setLoading(false);\n        }\n    }, [eventId, showErrorModal, t]);\n\n    useEffect(() => {\n        if (eventId) {\n            fetchTickets();\n        } else {\n            setTickets([]);\n        }\n    }, [eventId, fetchTickets]);\n\n    // Intelligent Sorting: Error > Unsent > Sent\n    const sortedTickets = useMemo(() => {\n        return [...tickets].sort((a, b) => {\n            const getPriority = (t) => {\n                if (t.emailStatus === 'error') return 0;\n                if (!t.emailStatus || t.emailStatus !== 'sent') return 1;\n                return 2;\n            };\n            return getPriority(a) - getPriority(b);\n        });\n    }, [tickets]);\n\n    const handleFileChange = async (e) => {\n        const file = e.target.files[0];\n        if (file) {\n            try {\n                const result = await import('../services/api').then(m => m.uploadBackground(file));\n                setBgFilename(result.filename || result);\n            } catch (err) {\n                showErrorModal(`${t('errorUploadFailed')}: ${err.message}`);\n            }\n        }\n    };\n\n    const handleConfigChange = (e) => {\n        const { name, value } = e.target;\n        setConfig(prev => ({\n            ...prev, \n            [name]: ['messageBefore', 'messageAfter', 'emailSubject', 'senderName'].includes(name) ? value : (parseInt(value) || 0)\n        }));\n    };\n\n    const toggleSelectAll = () => {\n        if (selectedTicketIds.size === tickets.length) {\n            setSelectedTicketIds(new Set());\n        } else {\n            setSelectedTicketIds(new Set(tickets.map(t => t.id)));\n        }\n    };\n\n    const toggleSelection = (id) => {\n        const newSet = new Set(selectedTicketIds);\n        if (newSet.has(id)) newSet.delete(id);\n        else newSet.add(id);\n        setSelectedTicketIds(newSet);\n    };\n\n    const selectUnsent = () => {\n        const unsent = tickets.filter(t => t.emailStatus !== 'sent').map(t => t.id);\n        if (unsent.length > 0) {\n            setSelectedTicketIds(new Set(unsent));\n        } else {\n            alert(\"All tickets have been sent!\");\n        }\n    };\n\n    const handleSendOne = async (ticket) => {\n        if (!ticket.attendeeEmail) return showErrorModal(\"This ticket has no email address.\");\n\n        setSending(true);\n        try {\n            await sendTicketEmail(eventId, ticket.id, bgFilename, config, config.messageBefore, config.messageAfter, config.emailSubject, config.senderName);\n            alert(t('emailSent', ticket.attendeeEmail));\n        } catch (err) {\n            showErrorModal(`${t('importFailed')}: ${err.message}`);\n        } finally {\n            setSending(false);\n        }\n    };\n\n    const handleBatchSend = async () => {\n        const targetTickets = selectedTicketIds.size > 0 \n            ? tickets.filter(t => selectedTicketIds.has(t.id)) \n            : tickets;\n\n        if (targetTickets.length === 0) return showErrorModal(\"No tickets available to send.\");\n\n        showConfirmModal(\n            t('modalSendBatchTitle'), \n            t('modalSendBatchBody', targetTickets.length),\n            async () => {\n                hideModal();\n                setSending(true);\n                try {\n                    const res = await sendBatchEmails(\n                        eventId, \n                        bgFilename, \n                        config, \n                        config.messageBefore, \n                        config.messageAfter, \n                        config.emailSubject, \n                        config.senderName,\n                        selectedTicketIds.size > 0 ? Array.from(selectedTicketIds) : null // Pass IDs if selected\n                    );\n                    \n                    let msg = `Batch Complete!\\nSuccess: ${res.result.success}\\nFailed: ${res.result.failed}`;\n                    if (res.result.errors && res.result.errors.length > 0) {\n                        msg += `\\n\\nErrors:\\n${res.result.errors.join('\\n')}`;\n                    }\n                    alert(msg);\n                    fetchTickets(); // Refresh statuses\n                } catch (err) {\n                    showErrorModal(`${t('importFailed')}: ${err.message}`);\n                } finally {\n                    setSending(false);\n                }\n            }\n        );\n    };    \n\n    const handlePreview = async (ticket) => {\n        setLoading(true);\n        try {\n            const imageSrc = await import('../services/api').then(m => m.getEmailPreview(eventId, ticket.id, bgFilename, config));\n            \n            const msgBefore = config.messageBefore || t('emailDefaultMsgBefore', eventId);\n            const msgAfter = config.messageAfter || t('emailDefaultMsgAfter');\n\n            const content = (\n                <div className=\"p-0 bg-gray-50 text-gray-800 rounded-xl max-w-2xl mx-auto border shadow-lg max-h-[80vh] overflow-y-auto\">\n                    <div className=\"bg-white p-8 text-center\">\n                        <h2 className=\"text-xl font-bold mb-4 text-gray-900\"></h2> \n                        <p className=\"text-gray-600 mb-6 whitespace-pre-wrap\">{msgBefore}</p>\n                        <div className=\"mb-6\">\n                            <img \n                                src={imageSrc} \n                                alt={`Ticket Preview for ${ticket.attendeeName}`}\n                                loading=\"lazy\"\n                                className=\"w-full h-auto rounded shadow-lg border\" \n                            />\n                        </div>\n                        <p className=\"text-gray-600 mb-6 whitespace-pre-wrap\">{msgAfter}</p>\n                        <p className=\"text-xs text-gray-400 mt-8 pt-4 border-t\">Ticket ID: {ticket.id}</p>\n                    </div>\n                </div>\n            );\n            \n            showModal({ type: 'custom', title: t('btnSimulate'), body: content, contentComponent: () => content });\n        } catch (err) {\n            showErrorModal(`Preview failed: ${err.message}`);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (!eventId) {\n        return (\n            <Layout>\n                <div className=\"flex-1 flex items-center justify-center text-gray-500 h-full\">\n                    {t('errorNoEventSelected')}\n                </div>\n                <Modal isOpen={!!modalContent} onClose={hideModal} content={modalContent || {}} />\n            </Layout>\n        );\n    }\n\n    return (\n        <Layout>\n            <div className=\"flex-1 flex flex-col h-full relative overflow-hidden\">\n                <div className=\"fixed inset-0 pointer-events-none ambient-glow -z-10\"></div>\n                \n                <div className=\"p-8 flex flex-col h-full max-w-7xl mx-auto w-full\">\n                \n                    <div className=\"flex flex-col md:flex-row justify-between items-end mb-8 pb-4 border-b border-white/10 gap-4 shrink-0\">\n                        <div>\n                            <h1 className=\"text-3xl font-bold text-white rainbow-text tracking-tight\">{t('emailTitle')}</h1>\n                            <p className=\"text-gray-400 mt-1 flex items-center gap-2\">\n                                {t('emailManageCommunications')} \n                                <span className=\"glass-panel px-2 py-0.5 rounded text-purple-300 font-mono text-sm\">{eventId}</span>\n                            </p>\n                        </div>\n                        <div className=\"flex gap-3\">\n                            <SmartButton \n                                variant=\"glass\"\n                                onClick={selectUnsent}\n                                className=\"px-4 py-3 text-sm\"\n                            >\n                                Select Unsent\n                            </SmartButton>\n                            <SmartButton \n                                variant=\"glass\"\n                                onClick={() => setShowSettings(!showSettings)}\n                                className=\"px-6 py-3\"\n                                icon=\"âš™ï¸\"\n                            >\n                                {t('btnSettings')}\n                            </SmartButton>\n                            <SmartButton \n                                variant=\"primary\"\n                                onClick={handleBatchSend}\n                                disabled={sending || loading}\n                                loading={sending}\n                                loadingText=\"Sending...\"\n                                className=\"px-6 py-3\"\n                                icon=\"ðŸš€\"\n                            >\n                                {selectedTicketIds.size > 0 ? `Send to ${selectedTicketIds.size}` : t('btnBatch')}\n                            </SmartButton>\n                        </div>\n                    </div>\n\n                    <AnimatePresence>\n                        {showSettings && (\n                            <motion.div \n                                initial={{ height: 0, opacity: 0, marginBottom: 0 }}\n                                animate={{ height: 'auto', opacity: 1, marginBottom: 32, transition: { ease: EASING.gentle, duration: 0.4 } }}\n                                exit={{ height: 0, opacity: 0, marginBottom: 0, transition: { ease: EASING.gentle, duration: 0.3 } }}\n                                className=\"overflow-hidden relative z-50 shrink-0\"\n                            >\n                                <div className=\"glass-panel p-6 rounded-3xl border border-white/10 bg-white/5 grid grid-cols-1 md:grid-cols-2 lg:col-span-4 gap-6\">\n                                    <div className=\"col-span-1 md:col-span-2 lg:col-span-4\">\n                                        <label className=\"block text-xs font-bold text-gray-400 uppercase mb-2\">{t('labelBg')}</label>\n                                        <input type=\"file\" onChange={handleFileChange} className=\"block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100\"/>\n                                        {bgFilename && <p className=\"text-xs text-green-400 mt-1\">Active: {bgFilename}</p>}\n                                    </div>\n                                    \n                                    <div className=\"col-span-1 md:col-span-2 lg:col-span-2\">\n                                        <label className=\"block text-xs font-bold text-gray-400 uppercase mb-2\">{t('labelSubject')}</label>\n                                        <input \n                                            type=\"text\"\n                                            name=\"emailSubject\" \n                                            value={config.emailSubject} \n                                            onChange={handleConfigChange}\n                                            placeholder={t('emailSubjectPlaceholder')}\n                                            className=\"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none text-sm\"\n                                        />\n                                    </div>\n                                    <div className=\"col-span-1 md:col-span-2 lg:col-span-2\">\n                                        <label className=\"block text-xs font-bold text-gray-400 uppercase mb-2\">{t('labelSender')}</label>\n                                        <input \n                                            type=\"text\"\n                                            name=\"senderName\" \n                                            value={config.senderName} \n                                            onChange={handleConfigChange}\n                                            placeholder={t('emailSenderPlaceholder')}\n                                            className=\"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none text-sm\"\n                                        />\n                                    </div>\n\n                                    <div className=\"col-span-1 md:col-span-2 lg:col-span-2\">\n                                        <label className=\"block text-xs font-bold text-gray-400 uppercase mb-2\">{t('labelPreamble')}</label>\n                                        <textarea \n                                            name=\"messageBefore\" \n                                            value={config.messageBefore} \n                                            onChange={handleConfigChange}\n                                            placeholder={t('emailPreamblePlaceholder')}\n                                            className=\"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none h-24 text-sm resize-none\"\n                                        />\n                                    </div>\n                                    <div className=\"col-span-1 md:col-span-2 lg:col-span-2\">\n                                        <label className=\"block text-xs font-bold text-gray-400 uppercase mb-2\">{t('labelFinePrint')}</label>\n                                        <textarea \n                                            name=\"messageAfter\" \n                                            value={config.messageAfter} \n                                            onChange={handleConfigChange}\n                                            placeholder={t('emailFinePrintPlaceholder')}\n                                            className=\"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none h-24 text-sm resize-none\"\n                                        />\n                                    </div>\n\n                                    {['qrSize', 'qrX', 'qrY', 'fontSize', 'nameX', 'nameY'].map(key => (\n                                        <div key={key}>\n                                            <label className=\"block text-xs font-bold text-gray-400 uppercase mb-2\">{key}</label>\n                                            <input \n                                                type=\"number\" name={key} value={config[key]} onChange={handleConfigChange}\n                                                className=\"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none\"\n                                            />\n                                        </div>\n                                    ))}\n                                </div>\n                            </motion.div>\n                        )}\n                    </AnimatePresence>\n\n                    <div className=\"glass-panel rounded-3xl overflow-hidden border border-white/5 flex-1 flex flex-col min-h-0\">\n                        <div className=\"overflow-y-auto custom-scrollbar flex-1\">\n                            <table className=\"w-full text-left border-collapse relative\">\n                                <thead className=\"bg-gray-950/95 backdrop-blur text-gray-400 text-xs uppercase tracking-wider sticky top-0 z-10 shadow-sm\">\n                                    <tr>\n                                        <th className=\"p-4 w-10\">\n                                            <input \n                                                type=\"checkbox\" \n                                                checked={tickets.length > 0 && selectedTicketIds.size === tickets.length}\n                                                onChange={toggleSelectAll}\n                                                className=\"rounded border-gray-600 bg-transparent focus:ring-indigo-500\"\n                                            />\n                                        </th>\n                                        <th className=\"p-4\">{t('colAttendee')}</th>\n                                        <th className=\"p-4\">{t('colEmail')}</th>\n                                        <th className=\"p-4\">{t('colStatus')}</th>\n                                        <th className=\"p-4 text-right\">{t('colActions')}</th>\n                                    </tr>\n                                </thead>\n                                <motion.tbody \n                                    variants={containerStagger}\n                                    initial=\"hidden\"\n                                    animate=\"visible\"\n                                    className=\"divide-y divide-white/5\"\n                                >\n                                    {sortedTickets.map(ticket => (\n                                        <motion.tr \n                                            key={ticket.id} \n                                            variants={fadeInUp}\n                                            layout\n                                            className={`hover:bg-white/5 transition-colors ${selectedTicketIds.has(ticket.id) ? 'bg-indigo-500/10' : ''}`}\n                                            onClick={() => toggleSelection(ticket.id)}\n                                        >\n                                            <td className=\"p-4\">\n                                                <input \n                                                    type=\"checkbox\" \n                                                    checked={selectedTicketIds.has(ticket.id)}\n                                                    onChange={() => {}} // Handled by row click\n                                                    className=\"rounded border-gray-600 bg-transparent focus:ring-indigo-500 pointer-events-none\"\n                                                />\n                                            </td>\n                                            <td className=\"p-4 font-medium selectable\">{ticket.attendeeName}</td>\n                                            <td className=\"p-4 text-gray-400 selectable\">{ticket.attendeeEmail}</td>\n                                            <td className=\"p-4\">\n                                                <span className={`px-2 py-1 rounded text-xs font-bold ${ticket.status === 'checked-in' ? 'bg-green-500/20 text-green-400' : 'bg-blue-500/20 text-blue-400'}`}>\n                                                    {ticket.status}\n                                                </span>\n                                                {ticket.emailStatus === 'sent' && <span className=\"ml-2 text-xs\">âœ… Sent</span>}\n                                            </td>\n                                            <td className=\"p-4 text-right space-x-2 flex justify-end\" onClick={e => e.stopPropagation()}>\n                                                <SmartButton \n                                                    variant=\"secondary\"\n                                                    onClick={() => handlePreview(ticket)}\n                                                    className=\"w-auto py-1.5 px-3 text-xs bg-gray-800 border-white/10\"\n                                                >\n                                                    {t('btnSimulate')}\n                                                </SmartButton>\n                                                <SmartButton \n                                                    variant=\"secondary\"\n                                                    onClick={() => handleSendOne(ticket)}\n                                                    disabled={sending}\n                                                    loading={sending} // This might be wrong if 'sending' is global. Usually row actions have individual loading state.\n                                                    // But the original code used global 'sending'. I'll stick to it.\n                                                    className=\"w-auto py-1.5 px-3 text-xs bg-indigo-600/20 text-indigo-300 border-indigo-500/30 hover:bg-indigo-600/40\"\n                                                >\n                                                    {t('btnHarass')}\n                                                </SmartButton>\n                                            </td>\n                                        </motion.tr>\n                                    ))}\n                                </motion.tbody>\n                            </table>\n                            \n                            {tickets.length === 0 && !loading && (\n                                <div className=\"p-12 text-center text-gray-500\">{t('emptyEmail')}</div>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <Modal isOpen={!!modalContent} onClose={hideModal} content={modalContent || {}} />\n        </Layout>\n    );\n};\n\nexport default EmailDashboard;\n"],"names":["EmailDashboard","eventId","useEvent","t","useLanguage","tickets","setTickets","useState","loading","setLoading","sending","setSending","showSettings","setShowSettings","selectedTicketIds","setSelectedTicketIds","Set","bgFilename","setBgFilename","config","setConfig","qrSize","qrX","qrY","fontSize","nameX","nameY","messageBefore","messageAfter","emailSubject","senderName","modalContent","showModal","hideModal","showErrorModal","showConfirmModal","useModal","fetchTickets","useCallback","async","data","getTickets","err","console","error","concat","message","useEffect","sortedTickets","useMemo","sort","a","b","getPriority","emailStatus","handleConfigChange","e","name","value","target","prev","_objectSpread","includes","parseInt","_jsxs","Layout","children","className","_jsx","SmartButton","variant","onClick","selectUnsent","unsent","filter","map","id","length","alert","icon","targetTickets","size","has","res","sendBatchEmails","Array","from","msg","result","success","failed","errors","join","disabled","loadingText","AnimatePresence","motion","div","initial","height","opacity","marginBottom","animate","transition","ease","EASING","gentle","duration","exit","type","onChange","file","files","then","m","uploadBackground","filename","placeholder","key","checked","toggleSelectAll","tbody","variants","containerStagger","ticket","tr","fadeInUp","layout","newSet","delete","add","toggleSelection","attendeeName","attendeeEmail","status","stopPropagation","imageSrc","getEmailPreview","msgBefore","msgAfter","content","src","alt","title","body","contentComponent","handlePreview","sendTicketEmail","handleSendOne","Modal","isOpen","onClose"],"sourceRoot":""}