"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[373],{373:(e,a,t)=>{t.r(a),t.d(a,{default:()=>b});var s=t(2555),l=t(5043),n=t(9570),r=t(2465),i=t(570),c=t(28),o=t(3840),d=t(1200),m=t(6555),x=t(6089),h=t(2136),g=t(5683),p=t(579);const b=()=>{const{eventId:e}=(0,x._)(),{t:a}=(0,h.o)(),[b,u]=(0,l.useState)([]),[f,j]=(0,l.useState)(!1),[y,N]=(0,l.useState)(!1),[v,w]=(0,l.useState)(!1),[S,k]=(0,l.useState)(new Set),[C,A]=(0,l.useState)(null),[B,P]=(0,l.useState)({qrSize:1150,qrX:220,qrY:1110,fontSize:150,nameX:400,nameY:925,messageBefore:"",messageAfter:"",emailSubject:"",senderName:""}),{modalContent:z,showModal:E,hideModal:M,showErrorModal:F,showConfirmModal:q}=(0,m.h)(),T=(0,l.useCallback)(async()=>{if(e){j(!0);try{const a=await(0,d.oP)(e);u(a),k(new Set)}catch(t){console.error("Failed to fetch tickets",t),F("".concat(a("errorCsvEmpty"),": ").concat(t.message))}finally{j(!1)}}},[e,F,a]);(0,l.useEffect)(()=>{e?T():u([])},[e,T]);const I=(0,l.useMemo)(()=>[...b].sort((e,a)=>{const t=e=>"error"===e.emailStatus?0:e.emailStatus&&"sent"===e.emailStatus?2:1;return t(e)-t(a)}),[b]),U=e=>{const{name:a,value:t}=e.target;P(e=>(0,s.A)((0,s.A)({},e),{},{[a]:["messageBefore","messageAfter","emailSubject","senderName"].includes(a)?t:parseInt(t)||0}))};return e?(0,p.jsxs)(i.A,{children:[(0,p.jsxs)("div",{className:"flex-1 flex flex-col h-full relative overflow-hidden",children:[(0,p.jsx)("div",{className:"fixed inset-0 pointer-events-none ambient-glow -z-10"}),(0,p.jsxs)("div",{className:"p-8 flex flex-col h-full max-w-7xl mx-auto w-full",children:[(0,p.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-end mb-8 pb-4 border-b border-white/10 gap-4 shrink-0",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("h1",{className:"text-3xl font-bold text-white rainbow-text tracking-tight",children:a("emailTitle")}),(0,p.jsxs)("p",{className:"text-gray-400 mt-1 flex items-center gap-2",children:[a("emailManageCommunications"),(0,p.jsx)("span",{className:"glass-panel px-2 py-0.5 rounded text-purple-300 font-mono text-sm",children:e})]})]}),(0,p.jsxs)("div",{className:"flex gap-3",children:[(0,p.jsx)(o.A,{variant:"glass",onClick:()=>{const e=b.filter(e=>"sent"!==e.emailStatus).map(e=>e.id);e.length>0?k(new Set(e)):alert("All tickets have been sent!")},className:"px-4 py-3 text-sm",children:"Select Unsent"}),(0,p.jsx)(o.A,{variant:"glass",onClick:()=>w(!v),className:"px-6 py-3",icon:"\u2699\ufe0f",children:a("btnSettings")}),(0,p.jsx)(o.A,{variant:"primary",onClick:async()=>{const t=S.size>0?b.filter(e=>S.has(e.id)):b;if(0===t.length)return F("No tickets available to send.");q(a("modalSendBatchTitle"),a("modalSendBatchBody",t.length),async()=>{M(),N(!0);try{const a=await(0,d.IL)(e,C,B,B.messageBefore,B.messageAfter,B.emailSubject,B.senderName,S.size>0?Array.from(S):null);let t="Batch Complete!\nSuccess: ".concat(a.result.success,"\nFailed: ").concat(a.result.failed);a.result.errors&&a.result.errors.length>0&&(t+="\n\nErrors:\n".concat(a.result.errors.join("\n"))),alert(t),T()}catch(t){F("".concat(a("importFailed"),": ").concat(t.message))}finally{N(!1)}})},disabled:y||f,loading:y,loadingText:"Sending...",className:"px-6 py-3",icon:"\ud83d\ude80",children:S.size>0?"Send to ".concat(S.size):a("btnBatch")})]})]}),(0,p.jsx)(n.N,{children:v&&(0,p.jsx)(r.P.div,{initial:{height:0,opacity:0,marginBottom:0},animate:{height:"auto",opacity:1,marginBottom:32,transition:{ease:g.Ux.gentle,duration:.4}},exit:{height:0,opacity:0,marginBottom:0,transition:{ease:g.Ux.gentle,duration:.3}},className:"overflow-hidden relative z-50 shrink-0",children:(0,p.jsxs)("div",{className:"glass-panel p-6 rounded-3xl border border-white/10 bg-white/5 grid grid-cols-1 md:grid-cols-2 lg:col-span-4 gap-6",children:[(0,p.jsxs)("div",{className:"col-span-1 md:col-span-2 lg:col-span-4",children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("labelBg")}),(0,p.jsx)("input",{type:"file",onChange:async e=>{const s=e.target.files[0];if(s)try{const e=await Promise.resolve().then(t.bind(t,1200)).then(e=>e.uploadBackground(s));A(e.filename||e)}catch(l){F("".concat(a("errorUploadFailed"),": ").concat(l.message))}},className:"block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100"}),C&&(0,p.jsxs)("p",{className:"text-xs text-green-400 mt-1",children:["Active: ",C]})]}),(0,p.jsxs)("div",{className:"col-span-1 md:col-span-2 lg:col-span-2",children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("labelSubject")}),(0,p.jsx)("input",{type:"text",name:"emailSubject",value:B.emailSubject,onChange:U,placeholder:a("emailSubjectPlaceholder"),className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none text-sm"})]}),(0,p.jsxs)("div",{className:"col-span-1 md:col-span-2 lg:col-span-2",children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("labelSender")}),(0,p.jsx)("input",{type:"text",name:"senderName",value:B.senderName,onChange:U,placeholder:a("emailSenderPlaceholder"),className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none text-sm"})]}),(0,p.jsxs)("div",{className:"col-span-1 md:col-span-2 lg:col-span-2",children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("labelPreamble")}),(0,p.jsx)("textarea",{name:"messageBefore",value:B.messageBefore,onChange:U,placeholder:a("emailPreamblePlaceholder"),className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none h-24 text-sm resize-none"})]}),(0,p.jsxs)("div",{className:"col-span-1 md:col-span-2 lg:col-span-2",children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("labelFinePrint")}),(0,p.jsx)("textarea",{name:"messageAfter",value:B.messageAfter,onChange:U,placeholder:a("emailFinePrintPlaceholder"),className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none h-24 text-sm resize-none"})]}),["qrSize","qrX","qrY","fontSize","nameX","nameY"].map(e=>(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:e}),(0,p.jsx)("input",{type:"number",name:e,value:B[e],onChange:U,className:"w-full bg-black/50 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-blue-500 outline-none"})]},e))]})})}),(0,p.jsx)("div",{className:"glass-panel rounded-3xl overflow-hidden border border-white/5 flex-1 flex flex-col min-h-0",children:(0,p.jsxs)("div",{className:"overflow-y-auto custom-scrollbar flex-1",children:[(0,p.jsxs)("table",{className:"w-full text-left border-collapse relative",children:[(0,p.jsx)("thead",{className:"bg-gray-950/95 backdrop-blur text-gray-400 text-xs uppercase tracking-wider sticky top-0 z-10 shadow-sm",children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{className:"p-4 w-10",children:(0,p.jsx)("input",{type:"checkbox",checked:b.length>0&&S.size===b.length,onChange:()=>{S.size===b.length?k(new Set):k(new Set(b.map(e=>e.id)))},className:"rounded border-gray-600 bg-transparent focus:ring-indigo-500"})}),(0,p.jsx)("th",{className:"p-4",children:a("colAttendee")}),(0,p.jsx)("th",{className:"p-4",children:a("colEmail")}),(0,p.jsx)("th",{className:"p-4",children:a("colStatus")}),(0,p.jsx)("th",{className:"p-4 text-right",children:a("colActions")})]})}),(0,p.jsx)(r.P.tbody,{variants:g.tl,initial:"hidden",animate:"visible",className:"divide-y divide-white/5",children:I.map(s=>(0,p.jsxs)(r.P.tr,{variants:g.tE,layout:!0,className:"hover:bg-white/5 transition-colors ".concat(S.has(s.id)?"bg-indigo-500/10":""),onClick:()=>(e=>{const a=new Set(S);a.has(e)?a.delete(e):a.add(e),k(a)})(s.id),children:[(0,p.jsx)("td",{className:"p-4",children:(0,p.jsx)("input",{type:"checkbox",checked:S.has(s.id),onChange:()=>{},className:"rounded border-gray-600 bg-transparent focus:ring-indigo-500 pointer-events-none"})}),(0,p.jsx)("td",{className:"p-4 font-medium selectable",children:s.attendeeName}),(0,p.jsx)("td",{className:"p-4 text-gray-400 selectable",children:s.attendeeEmail}),(0,p.jsxs)("td",{className:"p-4",children:[(0,p.jsx)("span",{className:"px-2 py-1 rounded text-xs font-bold ".concat("checked-in"===s.status?"bg-green-500/20 text-green-400":"bg-blue-500/20 text-blue-400"),children:s.status}),"sent"===s.emailStatus&&(0,p.jsx)("span",{className:"ml-2 text-xs",children:"\u2705 Sent"})]}),(0,p.jsxs)("td",{className:"p-4 text-right space-x-2 flex justify-end",onClick:e=>e.stopPropagation(),children:[(0,p.jsx)(o.A,{variant:"secondary",onClick:()=>(async s=>{j(!0);try{const l=await Promise.resolve().then(t.bind(t,1200)).then(a=>a.getEmailPreview(e,s.id,C,B)),n=B.messageBefore||a("emailDefaultMsgBefore",e),r=B.messageAfter||a("emailDefaultMsgAfter"),i=(0,p.jsx)("div",{className:"p-0 bg-gray-50 text-gray-800 rounded-xl max-w-2xl mx-auto border shadow-lg max-h-[80vh] overflow-y-auto",children:(0,p.jsxs)("div",{className:"bg-white p-8 text-center",children:[(0,p.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900"}),(0,p.jsx)("p",{className:"text-gray-600 mb-6 whitespace-pre-wrap",children:n}),(0,p.jsx)("div",{className:"mb-6",children:(0,p.jsx)("img",{src:l,alt:"Ticket Preview for ".concat(s.attendeeName),loading:"lazy",className:"w-full h-auto rounded shadow-lg border"})}),(0,p.jsx)("p",{className:"text-gray-600 mb-6 whitespace-pre-wrap",children:r}),(0,p.jsxs)("p",{className:"text-xs text-gray-400 mt-8 pt-4 border-t",children:["Ticket ID: ",s.id]})]})});E({type:"custom",title:a("btnSimulate"),body:i,contentComponent:()=>i})}catch(l){F("Preview failed: ".concat(l.message))}finally{j(!1)}})(s),className:"w-auto py-1.5 px-3 text-xs bg-gray-800 border-white/10",children:a("btnSimulate")}),(0,p.jsx)(o.A,{variant:"secondary",onClick:()=>(async t=>{if(!t.attendeeEmail)return F("This ticket has no email address.");N(!0);try{await(0,d.z9)(e,t.id,C,B,B.messageBefore,B.messageAfter,B.emailSubject,B.senderName),alert(a("emailSent",t.attendeeEmail))}catch(s){F("".concat(a("importFailed"),": ").concat(s.message))}finally{N(!1)}})(s),disabled:y,loading:y,className:"w-auto py-1.5 px-3 text-xs bg-indigo-600/20 text-indigo-300 border-indigo-500/30 hover:bg-indigo-600/40",children:a("btnHarass")})]})]},s.id))})]}),0===b.length&&!f&&(0,p.jsx)("div",{className:"p-12 text-center text-gray-500",children:a("emptyEmail")})]})})]})]}),(0,p.jsx)(c.A,{isOpen:!!z,onClose:M,content:z||{}})]}):(0,p.jsxs)(i.A,{children:[(0,p.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-500 h-full",children:a("errorNoEventSelected")}),(0,p.jsx)(c.A,{isOpen:!!z,onClose:M,content:z||{}})]})}}}]);
//# sourceMappingURL=373.863dfb4c.chunk.js.map