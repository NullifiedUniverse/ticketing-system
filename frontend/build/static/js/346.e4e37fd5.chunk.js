"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[346],{346:(e,t,r)=>{r.r(t),r.d(t,{default:()=>k});var a=r(5043),s=r(6089),l=r(1200),n=r(579);const o="celestial_raffle_sync_v3",c={bgInner:"#020617",bgOuter:"#000000",primary:"#22d3ee",secondary:"#a5f3fc",gold:"#FFD700",product:"#fbbf24",text:"#ffffff",placeholderBg:"#1e293b",placeholderStroke:"#475569"},i={friction:.96,starCount:600,shockwaveMaxRadius:100},h={revealDelayL:800,revealDelayS:1200,connectDuration:6e3,centerDuration:3e3,productInDuration:1200},d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;if(e.length<2)return[];const r=[],a=[e[0],...e,e[e.length-1]];for(let s=0;s<a.length-3;s++){const[e,l,n,o]=[a[s],a[s+1],a[s+2],a[s+3]];for(let a=0;a<t;a++){const s=a/t,c=s*s,i=c*s,h=2*c-i-s,d=3*i-5*c+2,p=-3*i+4*c+s,u=i-c,f=.5*(e.x*h+l.x*d+n.x*p+o.x*u),g=.5*(e.y*h+l.y*d+n.y*p+o.y*u);r.push({x:f,y:g})}}return r.push(e[e.length-1]),r},p=e=>1===e?1:1-Math.pow(2,-10*e),u=e=>1-Math.pow(1-e,3),f=(e,t)=>Math.random()*(t-e)+e,g=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),x=(e,t)=>({x:f(0,e),y:f(0,t),z:f(.5,2.5),size:f(.5,2),alpha:Math.random(),blinkSpeed:f(.001,.006),vx:f(-.05,.05),vy:f(-.05,.05),color:Math.random()>.9?c.secondary:"#fff",isTarget:!1}),m=function(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const s=Math.random()*Math.PI*2,l=f(.5,2.5)*a;return{x:e,y:t,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:1,decay:f(.005,.015),color:r,size:f(1,4),drag:i.friction}},y=(e,t,r)=>({x:e,y:t,radius:1,maxRadius:i.shockwaveMaxRadius,alpha:1,color:r}),S=(e,t,r,a)=>{const s=r+Math.PI+f(-.15,.15),l=f(1,3);return{x:e,y:t,vx:Math.cos(s)*l,vy:Math.sin(s)*l,life:1,decay:f(.03,.05),size:f(1,4),color:a||"hsl(".concat(f(180,220),", 100%, 70%)")}},v=(e,t,r)=>{e.forEach(e=>{e.isTarget||(e.x+=e.vx*e.z,e.y+=e.vy*e.z,e.x<-50&&(e.x=t+50),e.x>t+50&&(e.x=-50),e.y<-50&&(e.y=r+50),e.y>r+50&&(e.y=-50),e.alpha+=e.blinkSpeed,(e.alpha>1||e.alpha<.2)&&(e.blinkSpeed*=-1))})},w=e=>{for(let t=e.length-1;t>=0;t--){const r=e[t];r.x+=r.vx,r.y+=r.vy,r.drag&&(r.vx*=r.drag,r.vy*=r.drag),r.life-=r.decay,r.life<=0&&e.splice(t,1)}},P=e=>{for(let t=e.length-1;t>=0;t--){const r=e[t];r.radius+=.1*(r.maxRadius-r.radius),r.alpha-=.02,r.alpha<=0&&e.splice(t,1)}},b=(e,t,r,a,s)=>{const l=e.createRadialGradient(t/2,r/2,0,t/2,r/2,t);if(l.addColorStop(0,c.bgInner),l.addColorStop(1,c.bgOuter),e.fillStyle=l,e.fillRect(0,0,t,r),"done"===a||"product_incoming"===a||"product_reveal"===a){const a=300*(.1*Math.sin(s)+.9),l=e.createRadialGradient(t/2,r/2,0,t/2,r/2,a);l.addColorStop(0,"rgba(34, 211, 238, 0.15)"),l.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=l,e.fillRect(0,0,t,r)}},I=(e,t,r,a)=>{if(t.length<2||a<=.01)return;const s=Math.floor(r*t.length);if(!(s<2)){e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let r=1;r<s;r++)e.lineTo(t[r].x,t[r].y);e.strokeStyle="rgba(34, 211, 238, ".concat(.5*a,")"),e.lineWidth=6,e.shadowBlur=20,e.shadowColor=c.primary,e.stroke(),e.strokeStyle="rgba(220, 255, 255, ".concat(a,")"),e.lineWidth=2,e.shadowBlur=0,e.stroke()}},M=(e,t,r,a)=>{if(t){if(e.save(),e.globalAlpha=r,e.translate(t.x,t.y),e.rotate(t.angle),a&&a.complete){const t=120;e.shadowBlur=40,e.shadowColor=c.product,e.drawImage(a,-t/2,-t/2,t,t)}else e.shadowBlur=40,e.shadowColor=c.product,e.fillStyle="#fff",e.beginPath(),e.ellipse(0,0,16,6,0,0,2*Math.PI),e.fill(),e.fillStyle=c.gold,e.beginPath(),e.arc(0,0,4,0,2*Math.PI),e.fill();e.restore()}},T=(e,t,r,a,s,l,n,o)=>{e.save(),e.translate(t,r),e.scale(a,a);const i=o?.35*o:350,h=Math.min(350,i),d=h/2;if(l&&l.complete){e.shadowBlur=50,e.shadowColor="rgba(251, 191, 36, 0.4)";const t=l.width/l.height;let r=h,a=h;t>1?a=h/t:r=h*t,e.drawImage(l,-r/2,-a/2,r,a),e.shadowBlur=0}else e.strokeStyle=c.gold,e.lineWidth=3,e.shadowBlur=20,e.shadowColor=c.product,e.strokeRect(-25,-25,50,50),e.stroke();if(e.restore(),a>.8){e.textAlign="center",e.shadowBlur=20;const a=1e3,l=(t,r,a,s,l)=>{e.font=s;const n=e.measureText(t).width;if(n>l){const s=l/n;e.save(),e.translate(r,a),e.scale(s,s),e.fillText(t,0,0),e.restore()}else e.fillText(t,r,a)};if(n){e.fillStyle=c.gold,e.textBaseline="bottom";const s=r-d-30;l(n.toUpperCase(),t,s,'900 36px "Inter", "Segoe UI", sans-serif',a)}e.fillStyle=c.product,e.textBaseline="top";l(s,t,r+d+40,'bold 60px "Inter", "Segoe UI", sans-serif',a),e.shadowBlur=0}},k=()=>{const e=(0,a.useRef)(null),{selectedEvent:t,loading:r}=(0,s._)(),[f,k]=(0,a.useState)(0),z=(0,a.useRef)({phase:"idle",stars:[],targetStars:[],particles:[],shockwaves:[],trailParticles:[],pathPoints:[],dims:{w:0,h:0},startTime:0,lineStartTime:0,centerStartTime:0,productStartTime:0,lineProgress:0,centerProgress:0,nebulaPulse:0,hasCelebrated:!1,hasProductExploded:!1,productComet:{x:0,y:0,startX:0,startY:0,angle:0},productScale:0,currentPrizeName:"",currentPrizeTitle:"",prizeImage:null});(0,a.useEffect)(()=>{const e=new BroadcastChannel(o);return e.onmessage=e=>{const{type:t,winner:r,prize:a}=e.data;"START_DRAW"===t?(console.log("Broadcast received: START_DRAW",r),E(r,a)):"RESET"===t&&C()},()=>e.close()},[]),(0,a.useEffect)(()=>{if(!t)return;const e=setInterval(async()=>{try{const e=await(0,l.My)(t.id);e.animationTrigger>f&&(k(e.animationTrigger),"DRAWING"===e.status||"REVEALED"===e.status?E(e.winner,e.currentPrize):"IDLE"===e.status&&C())}catch(e){}},1e3);return()=>clearInterval(e)},[t,f]);const C=()=>{const e=z.current;e.phase="idle",e.stars.forEach(e=>e.isTarget=!1),e.targetStars=[],e.hasCelebrated=!1,e.hasProductExploded=!1,e.prizeImage=null},E=(e,t)=>{if(!e)return;const r=z.current;let a="Mystery Prize",s="",l=null;if("object"===typeof t&&null!==t?(a=t.name||"Mystery Prize",s=t.title||"",l=t.image):"string"===typeof t&&(a=t),r.currentPrizeName=a,r.currentPrizeTitle=s,r.prizeImage=null,l){const e=new Image;e.src="/uploads/".concat(l),r.prizeImage=e}r.phase="revealing",r.startTime=performance.now(),r.particles=[],r.trailParticles=[],r.shockwaves=[],r.hasCelebrated=!1,r.hasProductExploded=!1,r.productScale=0,r.stars.forEach(e=>e.isTarget=!1);const{w:n,h:o}=r.dims,c=[...r.stars],i=[],h=150,d=(e.studentId||e.maskedId||e.name).toUpperCase(),p=/^L[SJ]\d{5}$/.test(d),u=d.split(""),f=u.length;for(let x=0;x<f;x++){let e=null;for(let r=0;r<50;r++){const t=Math.floor(Math.random()*c.length),r=c[t],a=i.some(e=>g(e,r)<120),s=r.x>h&&r.x<n-h&&r.y>h&&r.y<o-h;if(!a&&s){e=r,c.splice(t,1),e.isTarget=!0;break}}e||(e={x:n/2+100*(x-f/2),y:o/2,size:2});let t=x;p&&(t=0===x?0:1===x?7:x-1),i.push({origX:e.x,origY:e.y,currentX:e.x,currentY:e.y,size:e.size||2,currentSize:e.size||2,popScale:1,shake:0,char:u[x],charIndex:x,revealOrder:t,revealed:!1})}r.targetStars=i};return(0,a.useEffect)(()=>{const t=()=>{const t=e.current;if(!t)return;const{innerWidth:r,innerHeight:a}=window,s=window.devicePixelRatio||1;t.width=r*s,t.height=a*s,t.style.width="".concat(r,"px"),t.style.height="".concat(a,"px");t.getContext("2d").scale(s,s),z.current.dims={w:r,h:a},0===z.current.stars.length&&(z.current.stars=Array.from({length:i.starCount},()=>x(r,a)))};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),(0,a.useEffect)(()=>{let t;const r=e.current,a=e=>{const s=null===r||void 0===r?void 0:r.getContext("2d");if(!s)return;const l=z.current,{w:n,h:o}=l.dims;if(v(l.stars,n,o),w(l.particles),w(l.trailParticles),P(l.shockwaves),"revealing"===l.phase){const t=e-l.startTime;l.targetStars.forEach(e=>{const r=e.revealOrder;let a=!1;if(t>1e3+800*r&&(a=!0),a&&!e.revealed){e.revealed=!0,e.popScale=5,e.shake=10,l.shockwaves.push(y(e.currentX,e.currentY,c.primary));for(let t=0;t<20;t++)l.particles.push(m(e.currentX,e.currentY,c.primary,1.5))}e.revealed&&(e.popScale+=.05*(1-e.popScale),e.currentSize+=.05*(45-e.currentSize),e.shake>0&&(e.shake*=.9))});const r=Math.max(...l.targetStars.map(e=>e.revealOrder),0);if(t>1e3+800*r+1500){l.phase="connecting",l.lineStartTime=e;const t=[{x:0,y:o/2},...[...l.targetStars].sort((e,t)=>e.charIndex-t.charIndex).map(e=>({x:e.currentX,y:e.currentY}))];l.pathPoints=d(t,50)}}if("connecting"===l.phase){const t=e-l.lineStartTime;l.lineProgress=Math.min(t/h.connectDuration,1),l.targetStars.forEach(e=>e.popScale+=.05*(1-e.popScale)),l.lineProgress>=1&&(l.phase="centering",l.centerStartTime=e)}if("centering"===l.phase){const t=e-l.centerStartTime;l.centerProgress=Math.min(t/h.centerDuration,1);const r=p(l.centerProgress),a=Math.min(n/1920,1),s=65*a,i=45*a,u=35*a,f=n/2-l.targetStars.length*s/2+s/2,g=.12*o;l.targetStars.forEach(e=>{const t=f+e.charIndex*s,a=g;e.currentX=e.origX+(t-e.origX)*r,e.currentY=e.origY+(a-e.origY)*r,e.currentSize=i+u*r});const x=[{x:0,y:o/2},...[...l.targetStars].sort((e,t)=>e.charIndex-t.charIndex).map(e=>({x:e.currentX,y:e.currentY}))];if(l.pathPoints=d(x,50),l.centerProgress>=1&&(l.phase="done",!l.hasCelebrated)){l.shockwaves.push(y(n/2,g,c.gold));for(let e=0;e<150;e++)l.particles.push(m(n/2,g,c.gold,2));l.hasCelebrated=!0,l.productStartTime=e+1e3}}if("done"===l.phase&&e>l.productStartTime&&!l.hasProductExploded&&(l.phase="product_incoming",l.productComet={startX:n+100,startY:-100,x:n+100,y:-100,targetX:n/2,targetY:.55*o,angle:0},l.productStartTime=e),"product_incoming"===l.phase){const t=e-l.productStartTime,r=Math.min(t/h.productInDuration,1),a=u(r),s=l.productComet,n=s.x,o=s.y;s.x=s.startX+(s.targetX-s.startX)*a,s.y=s.startY+(s.targetY-s.startY)*a,s.angle=Math.atan2(s.y-o,s.x-n);for(let e=0;e<2;e++)l.trailParticles.push(S(s.x,s.y,s.angle+Math.PI,c.product));if(r>=1){l.phase="product_reveal",l.hasProductExploded=!0,l.productScale=0,l.shockwaves.push(y(s.x,s.y,c.product));for(let e=0;e<50;e++)l.particles.push(m(s.x,s.y,c.product,1.5))}}"product_reveal"===l.phase&&(l.productScale+=.1*(1.5-l.productScale)),"done"!==l.phase&&"product_incoming"!==l.phase&&"product_reveal"!==l.phase||(l.nebulaPulse+=.02),b(s,n,o,l.phase,l.nebulaPulse),l.stars.forEach(e=>{e.isTarget||(s.beginPath(),s.arc(e.x,e.y,e.size,0,2*Math.PI),s.fillStyle=e.color,s.globalAlpha=.8*e.alpha,s.fill(),s.globalAlpha=1)});const i="centering"===l.phase?1-l.centerProgress:1,f="centering"===l.phase?1:l.lineProgress;if(("connecting"===l.phase||"centering"===l.phase)&&l.pathPoints.length>0&&(I(s,l.pathPoints,f,i),"connecting"===l.phase)){const e=l.pathPoints.length,t=Math.floor(f*e);if(t>4){const e=l.pathPoints[t-1];if(e){const r=l.pathPoints[Math.max(0,t-4)],a=Math.atan2(e.y-r.y,e.x-r.x);for(let t=0;t<3;t++)l.trailParticles.push(S(e.x,e.y,a))}}}"product_incoming"===l.phase&&M(s,l.productComet,1,l.prizeImage),l.shockwaves.forEach(e=>{s.beginPath(),s.arc(e.x,e.y,e.radius,0,2*Math.PI),s.strokeStyle=e.color,s.lineWidth=2,s.globalAlpha=e.alpha,s.stroke(),s.globalAlpha=1}),[...l.particles,...l.trailParticles].forEach(e=>{s.globalAlpha=e.life,s.fillStyle=e.color,s.beginPath(),s.arc(e.x,e.y,e.size*e.life,0,2*Math.PI),s.fill(),s.globalAlpha=1}),l.targetStars.forEach(t=>{if(t.revealed){let r=t.popScale,a=c.primary;if("done"===l.phase||"product_incoming"===l.phase||"product_reveal"===l.phase){r+=.1*Math.sin(.003*e+t.charIndex)+.05,a="hsl(".concat(180+40*Math.sin(.002*e),", 100%, 70%)")}let n=t.currentX+(Math.random()-.5)*t.shake,o=t.currentY+(Math.random()-.5)*t.shake;const i=Math.floor(t.currentSize*r);s.font="bold ".concat(i,'px "Courier New", monospace'),s.shadowBlur=40*r,s.shadowColor=a,s.fillStyle=c.text,s.textAlign="center",s.textBaseline="middle",s.fillText(t.char,n,o),s.shadowBlur=0,s.fillText(t.char,n,o)}else s.beginPath(),s.arc(t.currentX,t.currentY,2*t.size,0,2*Math.PI),s.fillStyle="#FFF",s.shadowBlur=15,s.shadowColor="#fff",s.fill(),s.shadowBlur=0}),"product_reveal"===l.phase&&T(s,n/2,.55*o,l.productScale,l.currentPrizeName,l.prizeImage,l.currentPrizeTitle,o),t=requestAnimationFrame(a)};return a(0),()=>cancelAnimationFrame(t)},[]),r?(0,n.jsx)("div",{className:"w-full h-screen bg-black flex items-center justify-center text-cyan-500 font-mono",children:(0,n.jsx)("div",{className:"animate-pulse",children:"INITIALIZING CELESTIAL UPLINK..."})}):t?(0,n.jsxs)("div",{className:"relative w-full h-screen bg-black overflow-hidden cursor-none",children:[(0,n.jsx)("canvas",{ref:e,className:"block w-full h-full"}),(0,n.jsxs)("div",{className:"absolute top-4 right-4 text-xs text-white/10 select-none",children:["DISPLAY MODE \u2022 ",t.name.toUpperCase()]})]}):(0,n.jsxs)("div",{className:"w-full h-screen bg-black flex flex-col items-center justify-center text-slate-500 font-sans p-8 text-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-slate-300 mb-2",children:"Signal Lost"}),(0,n.jsx)("p",{children:"No active event channel detected."}),(0,n.jsx)("p",{className:"text-sm mt-4",children:"Please select an event in the Control Center."})]})}}}]);
//# sourceMappingURL=346.e4e37fd5.chunk.js.map